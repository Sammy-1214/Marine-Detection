import sys
import os
import cv2
import imutils
import pathlib
pathlib.PosixPath = pathlib.WindowsPath

# Add the YOLOv5 folder to the Python path
yolov5_path = os.path.abspath("C:/Users/dee41/OneDrive - rit.edu/College Assignments/Personal Projects/yolov5")
if yolov5_path not in sys.path:
    sys.path.append(yolov5_path)

from detect import run

# Run detection and save to folder
run(
    weights="runs_reference/train/marine_yolo5m_final/weights/best.pt",
    source="Test_marine_images/Dolphin.jpg",
    data="data.yaml",
    project="runs_testing/detect/predict",
    name="predict5",
    imgsz=(640, 640),
    conf_thres=0.3,
    save_conf=True
)

# Find the predicted image
output_folder = "runs_testing/detect/predict5"
image_name = os.path.basename("Test_marine_images/Dolphin.jpg")
result_path = os.path.join(output_folder, image_name)

# Read and display with OpenCV
if os.path.exists(result_path):
    results = cv2.imread(result_path)
    results_resized = imutils.resize(results, width=1000)
    cv2.imshow("Marine Animal YOLO Detection", results_resized)
    cv2.waitKey(0)
    cv2.destroyAllWindows()
else:
    print("Detection output not found")